<h1>IDカード自動発行システム</h1>

<div class="form-container">
    <label for="username">ユーザーネーム:</label>
    <input type="text" id="username" placeholder="例: 山田太郎" required>

    <label for="rank">階級:</label>
    <input type="text" id="rank" placeholder="例: 係長" required>

    <label for="department">所属:</label>
    <input type="text" id="department" placeholder="例: 営業部" required>

    <label for="company">所属先:</label>
    <input type="text" id="company" placeholder="例: ABC株式会社" required>

    <label for="date">配属年月日:</label>
    <input type="date" id="date" required>

    <!-- 画像アップロード -->
    <div class="upload-container">
        <label for="imageUpload">IDカードテンプレート画像をアップロード:</label>
        <input type="file" id="imageUpload" accept="image/*" onchange="previewImage(event)">
    </div>

    <button onclick="generateIDCard()">発行</button>
</div>

<!-- プレビュー表示用 -->
<canvas id="idCardCanvas" width="600" height="350"></canvas>

<script>
    let uploadedImage = null;  // アップロードされた画像

    // 画像アップロードのプレビュー
    function previewImage(event) {
        const reader = new FileReader();
        reader.onload = function() {
            uploadedImage = new Image();
            uploadedImage.onload = function() {
                const canvas = document.getElementById('idCardCanvas');
                const ctx = canvas.getContext('2d');
                // キャンバスに画像を描画
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                ctx.drawImage(uploadedImage, 0, 0, canvas.width, canvas.height);
            };
            uploadedImage.src = reader.result;
        };
        reader.readAsDataURL(event.target.files[0]);
    }

    // IDカード生成
    function generateIDCard() {
        const username = document.getElementById('username').value;
        const rank = document.getElementById('rank').value;
        const department = document.getElementById('department').value;
        const company = document.getElementById('company').value;
        const date = document.getElementById('date').value;

        const canvas = document.getElementById('idCardCanvas');
        const ctx = canvas.getContext('2d');

        if (!uploadedImage) {
            alert("テンプレート画像をアップロードしてください。");
            return;
        }

        // キャンバスにテンプレート画像を描画
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        ctx.drawImage(uploadedImage, 0, 0, canvas.width, canvas.height);

        // テキスト設定
        ctx.font = '20px Arial';
        ctx.fillStyle = '#333';

        // テキストを指定した位置に配置
        ctx.fillText('ユーザーネーム: ' + username, 20, 50);
        ctx.fillText('階級: ' + rank, 20, 90);
        ctx.fillText('所属: ' + department, 20, 130);
        ctx.fillText('所属先: ' + company, 20, 170);
        ctx.fillText('配属年月日: ' + date, 20, 210);

        // ダウンロードリンク生成
        const dataUrl = canvas.toDataURL('image/png');
        const a = document.createElement('a');
        a.href = dataUrl;
        a.download = username + '_IDCard.png';
        a.textContent = 'IDカードをダウンロード';
        document.body.appendChild(a);
    }
</script>
